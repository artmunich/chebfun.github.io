<!DOCTYPE html>
<html>
  <head>
    <title>Four bugs on a rectangle &raquo; Chebfun</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="shortcut icon" href="favicon.ico" />

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet"><!--  media="screen" -->
    <link href="/css/normalize.min.css" rel="stylesheet"><!--  media="screen" -->
    <link href="/css/chebsite.css" rel="stylesheet"><!--  media="screen" -->
    <link href="/css/tomorrow.css" rel="stylesheet"><!--  media="screen" -->
    <link href="/css/flexslider.css" rel="stylesheet"><!--  media="screen" -->

    <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic' rel='stylesheet' type='text/css'>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-4297200-10', 'chebfun.org');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>  </head>
  <body>
    <!-- Fixed navbar -->
    <div id='navbar' class="navbar navbar-default navbar-fixed-top">
      <div class="container nav">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
          <a id="logo" href="/"><img src='/images/logo.png' /></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/about">About</a></li>
            <li><a href="/news">News</a></li>
            <li><a href="/download">Download</a></li>
            <li><a href="/docs">Docs</a></li>
            <li><a href="/examples">Examples</a></li>
            <li><a href="/support">Support</a></li>
            <li><a href="/search"><span class="glyphicon glyphicon-search"></span></a></li>
            <li><a href="http://github.com/chebfun/chebfun"><img id='github-logo' src='/css/github-logo.png'/></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
<div class="page-wrapper">

    <div class='page-header'>
<h1>Four bugs on a rectangle</h1>
<h2>Hrothgar, November 2013<span><a href='/examples/ode-nonlin/FourBugs.m'>download</a><span class='sep-sm'>&middot;</span><a href='//github.com/chebfun/examples/blob/master/ode-nonlin/FourBugs.m'>view on GitHub</a></span></h2>
</div>

    <div class="container">
<div class="row main">
<div id='content' class="col-sm-12 example" role="main">
<p>Problem: Four particles start at $t=0$ at the vertices of a $2\times1$ rectangle. Each one chases the particle to its left with speed $1$. When does a collision occur?</p>
<pre class="mcode-input">format long, format compact
LW = 'linewidth'; FS = 'fontsize'; MS = 'markersize';</pre>

<h3 id="introduction">Introduction</h3>
<p>The above problem was posed by Trefethen [1] to students as an extension of a similar problem made famous by the great Martin Gardner in 1957, for whom the particles were instead bugs that begun on the corners of a square.</p>
<p>Here is a diagram of the rectangle version of the problem, which we will use Chebfun to solve. What paths will the bugs take, and when will they collide?</p>
<pre class="mcode-input">xx = [-1 1 1 -1];  yy = [-1 -1 1 1]/2;
uu = [1 0 -1 0];   vv = [0 1 0 -1];
quiver(xx, yy, uu, vv, 1/3, 'k-'), hold on
plot(xx, yy, 'k.', MS, 18), text(-.07,0,'?','FontSize',60)
hold off
text(.93,-.5,'1',FS,12), text(1,.43,'2',FS,12),
text(-.93,.5,'3',FS,12), text(-1,-.43,'4',FS,12)
axis tight equal off
title('The "Four bugs on a rectangle" problem', FS, 14)</pre>

<p><img src="img/FourBugs_01.png" class="figure" alt=""></p>
<h3 id="the-system-of-odes">The system of ODEs</h3>
<p>For notational and computational convenience, we will place the bugs on the corners of a $2\times1$ rectangle centered at the origin in the complex plane. By symmetry, bugs 1 and 3 will follow the same path rotated $180^{\circ}$, and so will 2 and 4. Thus the bugs will always form a parallelogram centered at the origin as they converge.</p>
<p>The system of ODEs that describes the motion of the bugs is derived as follows. We denote the position of bug $k$ as $z_k$ and the lengths of the sides of the parallelogram they form as $\ell_1$ and $\ell_2$. We let $\theta$ denote the internal angle formed by $z_2$ and its neighbors and $\phi$ the orientation of the system, equal to $\arg(z_2 - z_1)$. Now a system of ODEs governing the dance of the bugs may be written down [1]:</p>
<p>$$ \frac{\mathrm{d}z_1}{\mathrm{d}t} = \frac{z_2 - z_1}{|z_2 - z_1|}, \qquad
\frac{\mathrm{d}z_2}{\mathrm{d}t} = \frac{- z_2 - z_1}{|z_2 + z_1|}, $$</p>
<p>$$ \ell_1 \mathrm{e}^{\mathrm{i}\phi} = z_2 - z_1, \qquad
\ell_2 \mathrm{e}^{\mathrm{i}(\phi-\theta)} = z_1 + z_2. $$</p>
<p>However, it will be more convenient for us to work in an equivalent system in the variables $\ell_1, \ell_2, \phi, \theta$:</p>
<p>$$ \frac{\mathrm{d}\ell_1}{\mathrm{d}t} = -1 - \cos\theta, \qquad
\frac{\mathrm{d}\ell_2}{\mathrm{d}t} = -1 + \cos\theta, $$</p>
<p>$$ \frac{\mathrm{d}\theta}{\mathrm{d}t} = \left( \frac{1}{\ell_1}
    - \frac{1}{\ell_2} \right) \sin\theta, \qquad
\frac{\mathrm{d}\phi}{\mathrm{d}t} = \frac{\sin\theta}{\ell_1}. $$</p>
<p>The question of when the bugs collide is ready to be answered. If we add the derivatives of the side lengths, we find that $\frac{\mathrm{d}\ell_1}{\mathrm{d}t} - \frac{\mathrm{d}\ell_2}{\mathrm{d}t} = -2$, indicating that the rate of change of the perimeter of the parallelogram (twice the above) is the constant $-4$. The perimeter begins as $6$, so after exactly $1.5$ time units the bugs should collide at the origin.</p>
<p>However, there is much more to this problem than just the final collision time!</p>
<h3 id="solution-with-chebfun">Solution with Chebfun</h3>
<p>We can set up the bugs' dance as a system of ODEs in Chebfun to be solved with Chebfun's overload of ODE113:</p>
<pre class="mcode-input">interval = [-1.5, -.01]; % There is a singularity at t = 0.
opts = odeset('abstol', 5e-14, 'reltol', 5e-14);
fun = @(t, u) ... % u = [theta, phi, ell1, ell2]
      [ (1./u(3)-1./u(4)).*sin(u(1));
        sin(u(1))./u(3);
        -cos(u(1))-1;
        cos(u(1))-1 ];
initial_conds = [pi/2, pi/2, 1, 2];
u = chebfun.ode113(fun, interval, initial_conds, opts);</pre>

<p>The variable <code>u</code> is now a 4-column quasimatrix containing the solution to the system of differential equations. With some simple transformations we can reconstruct the paths of the four bugs in the complex plane.</p>
<pre class="mcode-input">theta = u(:,1);  phi = u(:,2);  ell1 = u(:,3);  ell2 = u(:,4);
bugs      = ( ell2.*exp(1i*(phi-theta)) - ell1.*exp(1i*phi) )/2;
bugs(:,2) = ( ell2.*exp(1i*(phi-theta)) + ell1.*exp(1i*phi) )/2;
bugs(:,3) = -bugs(:,1);  bugs(:,4) = -bugs(:,2);  bugs(:,5) = bugs(:,1);</pre>

<p>Here is a plot of their movement toward the origin.</p>
<pre class="mcode-input">plot(bugs, LW, 2), hold on
plot(xx, yy, 'k.', MS, 18), axis equal off
title('The dance of four bugs on a rectangle', FS, 14)</pre>

<p><img src="img/FourBugs_02.png" class="figure" alt=""></p>
<p>As explained above, the bugs always form a parallelogram as they converge. What is less obvious is how the parallelogram transforms as the bugs approach the origin. Here are some level sets of the bugs' approach.</p>
<pre class="mcode-input">for t = linspace(-1.5, -.01, 7),
    plot(bugs(t,:), 'k.-', MS, 18), hold on
end
ylim([-.55 .55])
title('The dance of four bugs on a rectangle, with level sets', FS, 14)
hold off</pre>

<p><img src="img/FourBugs_03.png" class="figure" alt=""></p>
<p>Here are the side lenghts as functions of time:</p>
<pre class="mcode-input">plot(ell1, 'r-', ell2, 'b-', LW, 2)
legend('length of sides 1,3', 'length of sides 2,4')
title('Parallelogram side lengths over time', FS, 14)</pre>

<p><img src="img/FourBugs_04.png" class="figure" alt=""></p>
<p>We can verify that the perimeter of the bugs' parallelogram decreases at the constant rate 4.</p>
<pre class="mcode-input">plot(2*diff(ell1 + ell2), 'k-', LW, 2)
ylim([-7 0])
title('Rate of change of parallelogram perimeter', FS, 14)</pre>

<p><img src="img/FourBugs_05.png" class="figure" alt=""></p>
<h3 id="computing-critical-times">Computing critical times</h3>
<p>The exposition in [1] also includes discussion of critical times at which the bugs form special shapes. In particular, at each $t\in t_\mathrm{rect}$ the bugs form a rectangle, and at each $t\in t_\mathrm{rhomb}$ the bugs form a rhombus. (The bugs form these shapes infinitely many times, but after the first few steps of their dance, the spatial scale has shrunk so much that we cannot hope to compute exact time values on a computer using this method.) Here is one way to find the first two times in $t_\mathrm{rect}$ using Chebfun. We can construct a chebfun to test the orthogonality of the parallelogram at any point in time. The roots of that function will then correspond to the times at which the bugs form a rectangle.</p>
<pre class="mcode-input">F_rect = chebfun(@(t) theta(t)-pi/2, interval);
t_rect_exact  = [-1.5; -0.148243863926]; % from Chapman et al. [1]
t_rect_est = roots(F_rect);              % Chebfun estimates
fprintf('{t_rect} exact (Chapman et al.):    %-2.16f    %-16.12f\n', t_rect_exact)
fprintf('{t_rect} estimated by Chebfun:      %-2.16f    %-16.16f\n', t_rect_est)</pre>

<pre class="mcode-output">{t_rect} exact (Chapman et al.):    -1.5000000000000000    -0.148243863926 
{t_rect} estimated by Chebfun:      -1.5000000000000000    -0.1482438639260601
</pre>

<p>Our second computed answer agrees to every digit with the time given in [1], and there is a chance that Chebfun has does even better. (The tolerance of the ODE solver was set to 5e-14, so in fact we should expect that Chebfun has done one digit better.)</p>
<p>If we construct a similar chebfun to test the equality of the parallelogram's side lengths, then its roots will correspond to the times when the bugs form a rhombus.</p>
<pre class="mcode-input">F_rhomb = chebfun(@(t) sum(diff(abs(bugs(t,1:4) - bugs(t,2:5)))), ...
            interval, 'vectorize');
t_rhomb_exact = [-0.328190029216; -0.011365703053]; % from Chapman et al. [1]
t_rhomb_est = roots(F_rhomb);                       % Chebfun estimates
fprintf('{t_rhomb} exact (Chapman et al.):    %-19.12f    %-12.12f\n', t_rhomb_exact)
fprintf('{t_rhomb} estimated by Chebfun:      %-16.16f    %-16.16f\n', t_rhomb_est)</pre>

<pre class="mcode-output">{t_rhomb} exact (Chapman et al.):    -0.328190029216        -0.011365703053
{t_rhomb} estimated by Chebfun:      -0.3281900292160747    -0.0113657030533572
</pre>

<p>Again, Chebfun gives an answer correct to as many digits as are available.</p>
<p>Let us plot the special configurations. First, the first rhombus:</p>
<pre class="mcode-input">tt = sort([t_rect_est, t_rhomb_est]);
plot(bugs, 'interval', [-1.5 tt(3)], LW, 2), hold on
plot(bugs(tt(3),:), 'k.-', MS, 18), hold off
axis equal, zoom(1.8), axis off
title(['rhombus, t = ' num2str(tt(3),10)], FS, 12)</pre>

<p><img src="img/FourBugs_06.png" class="figure" alt=""></p>
<p>Now the second rectangle:</p>
<pre class="mcode-input">plot(bugs, 'interval', [-1.5 tt(2)], LW, 2), hold on
plot(bugs(tt(2),:), 'k.-', MS, 18), hold off
axis equal, zoom(4.4), axis off
title(['rectangle, t = ' num2str(tt(2),10)], FS, 12)</pre>

<p><img src="img/FourBugs_07.png" class="figure" alt=""></p>
<p>Finally, the second rombus, flattened nearly to one dimension.</p>
<pre class="mcode-input">plot(bugs, 'interval', [-1.5 tt(4)], LW, 2), hold on
plot(bugs(tt(4),:), 'k.-', MS, 18), hold off
axis equal, zoom(52), axis off
title(['rhombus, t = ' num2str(tt(4),10)], FS, 12)</pre>

<p><img src="img/FourBugs_08.png" class="figure" alt=""></p>
<h3 id="references">References</h3>
<ol>
<li>S. J. Chapman, James Lottes, and Lloyd N. Trefethen. "Four bugs on a    rectangle." <em>Proceedings of the Royal Society A</em>, 467, no. 2127 (2011):    881-896.</li>
</ol></div>
        </div>
    </div>
</div>
    <div class="footer">
        <p>&copy; Copyright 2014 the University of Oxford and the Chebfun Developers.</p>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="https://google-code-prettify.googlecode.com/svn/loader/prettify.js?lang=matlab" type="text/javascript"></script>
    <script type="text/javascript" src="/js/config.js"></script>
    <script type="text/javascript" src="/js/jquery.flexslider-min.js"></script>
  </body>
</html>